# ููู ุงูุฅุนุฏุงุฏุงุช ุงููุญุฏุซ - config.py
# ุชู ุชุญุฏูุซู ููุชูุงูู ูุน ุงูููุฏ ุงููุญุณู ููุฒุงููุฉ ุฏูุชุฑุฉ ูุน Supabase

import os

# =============================================================================
# ุฅุนุฏุงุฏุงุช API ุฏูุชุฑุฉ
# =============================================================================

# ุฑุงุจุท API ุฏูุชุฑุฉ ุงูุฃุณุงุณู
# ูุฌุจ ุฃู ูููู ุจุงูุตูุบุฉ: https://shadowpeace.daftara.com/api2
BASE_URL = os.getenv("DAFTRA_URL", "https://shadowpeace.daftara.com/api2")

# ููุชุงุญ API ุงูุฎุงุต ุจุฏูุชุฑุฉ
# ูููู ุงูุญุตูู ุนููู ูู ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ ูู ุฏูุชุฑุฉ
DAFTRA_API_KEY = os.getenv("DAFTRA_APIKEY")

# ุงูุชุญูู ูู ูุฌูุฏ ููุชุงุญ API ุฏูุชุฑุฉ
if not DAFTRA_API_KEY:
    raise ValueError("โ ููุชุงุญ API ุฏูุชุฑุฉ ูุทููุจ. ูุฑุฌู ุชุนููู ูุชุบูุฑ ุงูุจูุฆุฉ DAFTRA_APIKEY")

# =============================================================================
# ุฅุนุฏุงุฏุงุช Supabase
# =============================================================================

# ุฑุงุจุท ูุดุฑูุน Supabase
# ูุฌุจ ุฃู ูููู ุจุงูุตูุบุฉ: https://your-project.supabase.co
SUPABASE_BASE_URL = os.getenv("SUPABASE_URL", "").rstrip("/")
SUPABASE_URL = f"{SUPABASE_BASE_URL}/rest/v1" if SUPABASE_BASE_URL else ""

# ููุชุงุญ API ุงูุฎุงุต ุจู Supabase (service_role key ููุนูููุงุช ุงูุฎูููุฉ)
SUPABASE_KEY = os.getenv("SUPABASE_KEY")

# ุงูุชุญูู ูู ูุฌูุฏ ุฅุนุฏุงุฏุงุช Supabase
if not SUPABASE_BASE_URL:
    raise ValueError("โ ุฑุงุจุท Supabase ูุทููุจ. ูุฑุฌู ุชุนููู ูุชุบูุฑ ุงูุจูุฆุฉ SUPABASE_URL")

if not SUPABASE_KEY:
    raise ValueError("โ ููุชุงุญ API Supabase ูุทููุจ. ูุฑุฌู ุชุนููู ูุชุบูุฑ ุงูุจูุฆุฉ SUPABASE_KEY")

# =============================================================================
# ุฅุนุฏุงุฏุงุช Headers ููุทูุจุงุช
# =============================================================================

# Headers ูุทูุจุงุช API ุฏูุชุฑุฉ
# ูุฌุจ ุงุณุชุฎุฏุงู 'apikey' ูููุณ 'APIKEY' ุฃู 'Authorization'
HEADERS_DAFTRA = {
    "apikey": DAFTRA_API_KEY,
    "Content-Type": "application/json"
}

# Headers ูุทูุจุงุช Supabase
# ุชู ุชุญุณูููุง ููุนูู ูุน ุงูููุฏ ุงููุญุฏุซ
HEADERS_SUPABASE = {
    "apikey": SUPABASE_KEY,
    "Authorization": f"Bearer {SUPABASE_KEY}",
    "Content-Type": "application/json",
    "Prefer": "return=minimal"  # ุชู ุชุบููุฑูุง ูู resolution=merge-duplicates
}

# =============================================================================
# ุฅุนุฏุงุฏุงุช ุงูุจูุงูุงุช ูุงูุชุตููุฉ
# =============================================================================

# ููุน ุงููุงุชูุฑุฉ ุงููุทููุจ ุฌูุจูุง
# 0 = ุนุฑูุถ ุงูุฃุณุนุงุฑุ 1 = ููุงุชูุฑ ุงููุจูุนุงุชุ 2 = ููุงุชูุฑ ุงูุดุฑุงุก
# ุชู ุชุตุญูุญูุง ูู 0 ุฅูู 1 ูุฌูุจ ููุงุชูุฑ ุงููุจูุนุงุช
EXPECTED_TYPE = 1

# ุนุฏุฏ ุงูุณุฌูุงุช ูู ูู ุตูุญุฉ
# ุชู ุชุญุณููู ูุชูุงุฒู ุจูู ุงูุณุฑุนุฉ ูุงุณุชููุงู ุงูุฐุงูุฑุฉ
PAGE_LIMIT = 50  # ุชู ุชููููู ูู 100 ูุชุญุณูู ุงูุงุณุชูุฑุงุฑ

# ูุนุฑูุงุช ุงููุฑูุน ุงููุฑุงุฏ ุฌูุจ ุงูุจูุงูุงุช ูููุง
# ุญุณุจ ุงููุนุฑูุฉ ุงููุชููุฑุฉ: ุงููุฑุน 2 = ุงูุนููุถุฉุ ุงููุฑุน 3 = ุงูุฑุฆูุณู
# ุชู ุชุญุฏูุซูุง ูุชุชูุงูู ูุน ุงููุนุฑูุฉ ุงูุตุญูุญุฉ
BRANCH_IDS = [2, 3]  # ุชู ุฅุฒุงูุฉ ุงููุฑุน 1 ูุฅุจูุงุก ุงููุฑูุน ุงูุตุญูุญุฉ

# =============================================================================
# ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ ููููุฏ ุงููุญุณู
# =============================================================================

# ุญุฌู ุงูุฏูุนุฉ ูุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู Supabase
# ูุญุฏุฏ ุนุฏุฏ ุงูุณุฌูุงุช ุงูุชู ูุชู ุฅุฑุณุงููุง ูู ุทูุจ ูุงุญุฏ
BATCH_SIZE = int(os.getenv("BATCH_SIZE", "100"))

# ุนุฏุฏ ูุญุงููุงุช ุฅุนุงุฏุฉ ุงูุทูุจ ูู ุญุงูุฉ ุงููุดู
MAX_RETRIES = int(os.getenv("MAX_RETRIES", "3"))

# ููุช ุงูุชุฃุฎูุฑ ุจูู ุงููุญุงููุงุช (ุจุงูุซูุงูู)
RETRY_DELAY = int(os.getenv("RETRY_DELAY", "2"))

# ูููุฉ ุงูุชุธุงุฑ ุงูุทูุจุงุช (ุจุงูุซูุงูู)
REQUEST_TIMEOUT = int(os.getenv("REQUEST_TIMEOUT", "30"))

# ุชูุนูู/ุฅูุบุงุก ุชูุนูู ุญูุธ ุงูุณุฌูุงุช ุงููุงุดูุฉ
SAVE_FAILED_RECORDS = os.getenv("SAVE_FAILED_RECORDS", "true").lower() == "true"

# ูุณุชูู ุงูุชุณุฌูู (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO").upper()

# =============================================================================
# ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
# =============================================================================

# ุฃุณูุงุก ุงูุฌุฏุงูู ูู Supabase
TABLE_INVOICES = "invoices"
TABLE_INVOICE_ITEMS = "invoice_items"

# =============================================================================
# ุงูุชุญูู ูู ุตุญุฉ ุงูุฅุนุฏุงุฏุงุช
# =============================================================================

def validate_config():
    """ุงูุชุญูู ูู ุตุญุฉ ุฌููุน ุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ"""
    errors = []
    
    # ุงูุชุญูู ูู ุฑุงุจุท ุฏูุชุฑุฉ
    if not BASE_URL or not BASE_URL.startswith("https://"):
        errors.append("ุฑุงุจุท ุฏูุชุฑุฉ ุบูุฑ ุตุญูุญ")
    
    # ุงูุชุญูู ูู ุฑุงุจุท Supabase
    if not SUPABASE_URL or not SUPABASE_URL.startswith("https://"):
        errors.append("ุฑุงุจุท Supabase ุบูุฑ ุตุญูุญ")
    
    # ุงูุชุญูู ูู ูุนุฑูุงุช ุงููุฑูุน
    if not BRANCH_IDS or not isinstance(BRANCH_IDS, list):
        errors.append("ูุนุฑูุงุช ุงููุฑูุน ุบูุฑ ุตุญูุญุฉ")
    
    # ุงูุชุญูู ูู ููุน ุงููุงุชูุฑุฉ
    if EXPECTED_TYPE not in [0]:
        errors.append("ููุน ุงููุงุชูุฑุฉ ุบูุฑ ุตุญูุญ")
    
    if errors:
        raise ValueError(f"โ ุฃุฎุทุงุก ูู ุงูุฅุนุฏุงุฏุงุช: {', '.join(errors)}")
    
    return True

# ุชุดุบูู ุงูุชุญูู ุนูุฏ ุงุณุชูุฑุงุฏ ุงูููู
validate_config()

# =============================================================================
# ูุนูููุงุช ุฅุถุงููุฉ ูููุทูุฑูู
# =============================================================================

# ูุนูููุงุช ุงููุณุฎุฉ ูุงูุชุญุฏูุซ
CONFIG_VERSION = "2.0"
LAST_UPDATED = "2024-06-14"

# ุฑุณุงูุฉ ุชุฃููุฏ ุชุญููู ุงูุฅุนุฏุงุฏุงุช
print(f"โ ุชู ุชุญููู ุฅุนุฏุงุฏุงุช config v{CONFIG_VERSION} ุจูุฌุงุญ")
print(f"๐ ุฏูุชุฑุฉ: {BASE_URL}")
print(f"๐ Supabase: {SUPABASE_URL}")
print(f"๐ ุงููุฑูุน: {BRANCH_IDS}")
print(f"๐ ููุน ุงููุงุชูุฑุฉ: {EXPECTED_TYPE}")

